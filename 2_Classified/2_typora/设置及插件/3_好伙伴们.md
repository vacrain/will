# Typora 的好伙伴们

[toc]

## 整体说明

Typora 对于自身定位非常明确，就是一个 md 编辑器

这导致了他没有在线同步、图床等功能，都是依靠外部插件、软件或平台完成这些用户的特殊需求

2021/9/8

现在图床有这么些个问题

1. 如果放云端
    1. 不安全：因为是公开的，所以任何人只要根据一张图片就能找到图床位置
    2. 空间限制：长期使用的话，可能要考虑云空间不足的问题
2. 如果放本地：就要考虑是绝对定位还是相对定位
    1. 绝对定位：会有 mac、win、安卓、ios 这些系统切换的问题
        1. 如果只在单一系统上用，可取
        2. 如果要多平台使用，不可取
    2. 相对定位：如果引用图片的文档的位置发生变化，则很可能导致图片相对地址失效
        1. 如果图片和文档的相对位置非常确定，可取
        2. 如果图片和文档的相对位置有一丁点可能改变，不可取

**纯项目文档**的话，可以有一个很稳定的项目结构，所以可以使用**本地相对定位**来保存

**纯 iCloud**的用户，可以将文档与图片都放到 iCloud 中，使用**绝对定位**

综上，暂有这些结论供选择：

| 图床位置 | 定位方式 | 单一系统使用       | 多系统平台使用     | 纯 iCloud          | 纯项目文档         |
| -------- | -------- | ------------------ | ------------------ | ------------------ | ------------------ |
| 本地图床 | 绝对定位 | :heavy_check_mark: | ✖                  | :heavy_check_mark: | ✖                  |
| 本地图床 | 相对定位 | ✖                  | ✖                  | ✖                  | :heavy_check_mark: |
| 云端图床 | 绝对定位 | ✖                  | :heavy_check_mark: | ✖                  | ✖                  |

Typora 现在只有电脑端，手机端可以用 Taio！

## 坚果云——实现多端同步

> 这个不应该用人教...吧...

[坚果云怎么删除文件夹](https://help.jianguoyun.com/?p=1391)

[手机端有哪些能查看并编辑 Markdown 文件的 app？ - 坚果云的回答 - 知乎](https://www.zhihu.com/question/422079819/answer/1701099274)

## PicGo + gitee——实现图床功能（gitee 黄了，改用 github）

> 注意：Typora 在更新时，有可能会恢复默认设置，所以可能导致 picgo 失效。如失效，再配置一遍即可
>
> 参考：[typora + picgo (core) + gitee 无界面 (CLI) 配置](https://blog.csdn.net/m0_37952030/article/details/109138431)

**整体的步骤**：

1. [Gitee 申请图床](#Gitee 申请图床)
2. [修改 Typora 配置](#修改Typora配置)
3. [安装 PicGo](#安装PicGo)
4. [修改上传配置文件](#修改上传配置文件)
5. [测试上传图片](#测试上传图片)

### Gitee 申请图床

步骤如下：

1. 注册、登录
2. 在【设置】-【安全设置：私人令牌】新增一个令牌：
   <img src="https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 08-43-38_image-20210908084336680.png" alt="image-20210908084336680" style="zoom:25%;" />
3. 点击提交之后把 token 复制下来，这个 token 只会出现这一次，丢了就再生成新的令牌
4. 创建一个新的仓库，必须是**公开的**，因为 markdown 需要外部访问才能显示出图片
5. 添加文件夹
    1. **非计算机相关专业人员**：在 gitee 上操作即可
    2. **计算机相关的人员**：需要用使用 git ，把仓库 clone 到本地，新建文件夹，且新文件夹下随便创建一个文件，再提交，操作如下：

```
git clone https://gitee.com/用户名/仓库名.git
cd 仓库名
*********** 新建文件夹 img，且在 img 文件夹里面随便创建一个文件，如 txt 文件 ***********
git add .
git commit -m "新建文件夹"
git push
————————————————
版权声明：本文为CSDN博主「Mr_Vague」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/m0_37952030/article/details/109138431
```

> push 可能会失败（按照错误提示百度即可），但更可能是提示你要输入用户名密码（如果不想输入密码，需要配置一下 ssh，具体可以百度）
>
> 刷新仓库网址可以看到新建的文件夹就算成功

### 修改 Typora 配置

打开 Typora，打开【文件】-【偏好设置】-【图像】

1. 设置默认插入图片时，进行上传图片，按照下图进行选择即可

![image-20210908101117420](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 10-11-18_image-20210908101117420.png)

2. 上传图片设置

点开下拉框，可以看到有很多上传图片的服务：

![image-20210908101540490](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 10-15-41_image-20210908101540490.png)

**上面四个选项说明**：

-   None：不进行上传（不想上传的时，比如隐私图片，可以勾选这个，临时关闭上传功能）
-   PicGo-Core (command line) : 通过**PicGo 命令程序**进行上传（就是 cmd 中能用的命令，非计算机相关人员看下一个吧）
-   PicGo (app) : 通过**PicGo 客户端**（就是像安装百度网盘那样，安装软件，然后再使用）
    这个选项只有中文系统有，原因未知...
    中文系统中有该选项：![image-20210908102825396](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 10-28-26_image-20210908102825396.png)
    英文系统中，没有 `PicGo (app)` 选项：![image-20210908101354894](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 10-13-56_image-20210908101354894.png)
-   Custom Command ：自定义其他的上传图片服务，四个选项两个 PicGo 相关，可以看出天选之子 Picgo 是最好的上传图片的工具了

接下来

如果是 Win 系统，请选择`PicGo-Core (command line)` ，然后按照[Win 安装方式](#Win安装方式)进行安装

如果是 Mac 系统，请选择`PicGo (app) ` ，然后按照[Mac 安装方式](#Mac安装方式)进行安装

### 安装 PicGo

#### Win 安装方式

**安装并配置 picgo (core)**：

> 前提是安装好了 Nodejs，命令行能运行 npm

依次在终端窗口运行

```
# 全局安装 picgo
npm install picgo -g

# 查看 picgo 是否安装成功，运行下面代码，显示版本号即为安装成功，我使用的版本 1.4.21
picgo -v

# 安装 picgo 插件，用于使用gitee作为图床 和 上传图片时能在文件前缀加上时间戳
picgo install gitee-uploader super-prefix

# 启用 picgo 插件，运行下面命令后，使用上下方向键进行选择，按空格键可以勾选，按回车确定
picgo use plugins
```

![运行picgo use plugins 之后](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 10-48-08_20201017213823849.png)

#### Mac 安装方式

直接去下客户端软件，去[官网](https://github.com/Molunerfinn/PicGo/releases) ，下载`.dmg`格式的安装包：[PicGo-2.3.0-beta.6.dmg](https://github.com/Molunerfinn/PicGo/releases/download/v2.3.0-beta.6/PicGo-2.3.0-beta.6.dmg)

下载完`PicGo-2.3.0-beta.6.dmg`，点开！无脑安装~

> # 安完打不开软件的，下面要注意了！

打开 Picgo 应用，你会发现，软件无法使用（如下图）**点取消**！！！

<img src="https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/WX20210627-163017@2x.png" alt="WX20210627-163017@2x" style="zoom:50%;" />

打开【系统设置】，找【安全】，同意打开就好了

之后再打开 Picgo 应用，你会发现**没有窗口弹出来**，因为他**在顶部的菜单栏中**

右键点击菜单栏中的 Picgo，打开详细信息，这里需要下载两个插件，一个是`gitee-uploader`，另一个是`supper-prefix`

点 picgo 设置，除了 gitee 都取消选择

> 也有可能看不见 gitee，不要紧，设置一下就行：点图床设置，点 gitee

把设置都填好就行了

**supper-prefix 的配置如下：**

![image-20211016094956507](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-10-16_09-49-56_image-20211016094956507.png)

![image-20211016095159707](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-10-16_09-51-59_image-20211016095159707.png)

### 修改上传配置文件

安装完 PicGo，就剩下最后一步了，进行上传配置

Win 打开配置文件：

![image-20210908111146697](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 11-11-48_image-20210908111146697.png)

Mac 打开配置文件：

```
# 终端中运行
open ~/.picgo
```

之后找到并打开 config.json



把下面的配置再粘贴文件中即可：

> 这个``"path": "assets/imgs/2021"` ，如果怕图片都放一个文件夹太多了
> 那就每年手动修改一下吧，没啥别的好办法...
>
> 如果我下面的配置不行，也可以百度：typora picgo gitee config.json

```
{
  "picBed": {
    "uploader": "gitee",
    "current": "gitee",
    "transformer": "path",
    "gitee": {
      "repo": "vacrain/typora_img",
      "token": "494bf79fa86c2c54c900f0a7fe39c0ad",
      "path": "assets/imgs/2021",
      "customUrl": "",
      "branch": ""
    }
  },
  "picgoPlugins": {
    "picgo-plugin-gitee-uploader": true,
    "picgo-plugin-super-prefix": true
  },
  "picgo-plugin-super-prefix": {
    "prefixFormat": "YYYY-MM-DD HH-mm-ss_"
  },
  "picgo-plugin-gitee-uploader": {
    "lastSync": ""
  }
}
```

附说明版本：

```
{
  "picBed": {
    "uploader": "gitee",// 代表当前的上传图床
    "current": "gitee",
    "transformer": "path",
    "gitee": {
      "repo": "vacrain/typora_img",// 仓库名，格式是 username/reponame 必填
      "token": "494bf79fa86c2c54c900f0a7fe39c0ad",// gitee 私人令牌 必填
      "path": "assets/imgs/2021",// 自定义存储路径，比如 img/ 建议填
      "customUrl": "",// 没有自己的域名的话，可以默认为空就行； 如果自定义域名，注意要加http://或者https://
      "branch": ""// 分支名，默认是 master
    }
  },
  "picgoPlugins": {
    "picgo-plugin-gitee-uploader": true,
    "picgo-plugin-super-prefix": true
  },// 为插件预留
  "picgo-plugin-super-prefix": {
    "prefixFormat": "YYYY-MM-DD HH-mm-ss_"
  },// super-prefix插件配置
  "picgo-plugin-gitee-uploader": {
    "lastSync": ""
  }
}
```

### 测试上传图片

**测试方法一**：

找个图片粘贴到文档中进行测试即可！

测试成功标准：

1. 图片显示正常
2. 图片地址是 gitee 上的

**测试方法二**：

或者在 Typora 设置中，点测试按钮也行

![image-20210908111736267](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 11-17-37_image-20210908111736267.png)

点完上面的按钮，会弹出 log，看标题判断是否上传成功~

![image-20210908111715487](https://github.com/vacrain/typora_img/raw/main/assets/imgs/2021/2021-09-08 11-17-17_image-20210908111715487.png)

# Misc

> 注意！可能在 mac 直接给 picgo 安装插件不好使，需要用 npx 调用 picgo：
>
> ```
> npx picgo install gitee-uploader super-prefix
> ```

## PicGo 上传动图 gif 的坑

如果直接复制网页上的动图，去上传的话是截取的某帧，是静图。

暂时没有太好的办法。。就尽量别用动图吧，做一个动图也挺费劲的

（网上其他方案：应该下载到本地，然后在拖进去上传就可以了。）

## gitee typora-img 令牌

494bf79fa86c2c54c900f0a7fe39c0ad

## Mac 安装方法（不太行版本）

> 参考：
>
> [npm 查看全局包/路径【mac】](https://blog.csdn.net/ljy_1024/article/details/103610443)

1. npm 全局安装 picgo

```
npm i picgo -g
```

2. 查看 npm 全局安装路径

```
npm root -g
```

得到结果：/Users/wangxiansheng/lib/node_modules

```
# npm
export PATH=$PATH:/Users/wangxiansheng/bin:$PATH
```

```
/picgo u
```

```
wangxiansheng@wangxianshengdeMacBook-Pro: /Users/wangxiansheng
➜   npm i picgo -g
npm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142
npm WARN deprecated har-validator@5.1.5: this

/Users/wangxiansheng/bin/picgo -> /Users/wangxiansheng/lib/node_modules/picgo/bin/picgo

> ejs@2.7.4 postinstall /Users/wangxiansheng/lib/node_modules/picgo/node_modules/ejs
> node ./postinstall.js

Thank you for installing EJS: built with the Jake JavaScript build tool (https://jakejs.com/)

+ picgo@1.4.21
added 432 packages from 266 contributors in 14.546s

┌──────────────────────────────────────────────────────────────────┐
│                     npm update check failed                      │
│               Try running with sudo or get access                │
│               to the local update config store via               │
│ sudo chown -R $USER:$(id -gn $USER) /Users/wangxiansheng/.config │
└──────────────────────────────────────────────────────────────────┘
wangxiansheng@wangxianshengdeMacBook-Pro: /Users/wangxiansheng
➜   picgo install gitee-uploader super-prefix
zsh: command not found: picgo
```

```
wangxiansheng@wangxianshengdeMacBook-Pro: /Users/wangxiansheng
➜   npx picgo install gitee-uploader super-prefix

┌──────────────────────────────────────────────────────────────────┐
│                     npm update check failed                      │
│               Try running with sudo or get access                │
│               to the local update config store via               │
│ sudo chown -R $USER:$(id -gn $USER) /Users/wangxiansheng/.config │
└──────────────────────────────────────────────────────────────────┘
npm notice created a lockfile as package-lock.json. You should commit this file.
+ picgo-plugin-gitee-uploader@1.1.2
+ picgo-plugin-super-prefix@1.2.2
added 5 packages from 6 contributors in 0.894s

┌──────────────────────────────────────────────────────────────────┐
│                     npm update check failed                      │
│               Try running with sudo or get access                │
│               to the local update config store via               │
│ sudo chown -R $USER:$(id -gn $USER) /Users/wangxiansheng/.config │
└──────────────────────────────────────────────────────────────────┘
[PicGo SUCCESS]: 插件安装成功
```
